<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Grandma's Kitchen Family Recipe Archive">
  <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
  <meta name="googlebot" content="noindex, nofollow">
  <title>Grandma's Kitchen - Family Recipe Archive</title>
  <link rel="stylesheet" href="styles.min.css">
  <link rel="stylesheet" href="_pagefind/pagefind-ui.css">
</head>
<body>
  <!-- Sanctuary Loading Screen - Tribute to the Matriarchs -->
  <div id="sanctuary" class="sanctuary">
    <div class="sanctuary-content">
      <!-- Loading indicator -->
      <div class="sanctuary-loading">
        <div class="loading-spinner"></div>
        <span id="loading-status">Loading the Legacy...</span>
      </div>

      <!-- Section 1: Title and Intro (0-5s) -->
      <section class="sanctuary-section" id="sanctuary-intro">
        <h1 class="sanctuary-title">The Sanctuary of Service</h1>
        <p class="sanctuary-lead">
          For my mother and my grandmothers, the kitchen was never merely a room for cooking. It was a sanctuary of service.
        </p>
        <p>
          As these files download, you are accessing more than just ingredients and instructions. You are stepping into a lineage of hospitality that poured itself out, one meal at a time. You are seeing the evidence of God's providence, mediated through the hands of women who believed that feeding a family was a high calling—a daily act of worship through nourishment.
        </p>
      </section>

      <!-- Section 2: Granny (5-15s) -->
      <section class="sanctuary-section" id="sanctuary-granny">
        <div class="sanctuary-memory">
          <div class="memory-text">
            <h2>Granny</h2>
            <p>
              We remember the smell of beef roast and fried dough on the farm. We remember the sound of a house that was never quiet—always full of people, strangers turned into family, and those on the margins finding shelter under her roof.
            </p>
            <p>
              She lived by the work of her hands—<em>"If a man doesn't work, he doesn't eat"</em>—and she gave until she had nothing left to give, even her own couch. We remember the spaghetti made faithfully for church, and the boiled dinner with the hated rutabaga.
            </p>
            <p class="scripture-ref">
              She looked well to the ways of her household, and she did not eat the bread of idleness.
            </p>
          </div>
          <div class="memory-image">
            <img src="https://jsschrstrcks1.github.io/Grannysrecipes/granny/70.jpeg" alt="Handwritten recipe card from Granny's collection" loading="eager">
            <span class="image-caption">From the farm kitchen</span>
          </div>
        </div>
      </section>

      <!-- Section 3: Grandma (15-25s) -->
      <section class="sanctuary-section" id="sanctuary-grandma">
        <div class="sanctuary-memory">
          <div class="memory-image">
            <img src="data/Grandmas-recipes - 428.jpeg" alt="Handwritten recipe card marked Best Recipe" style="transform: rotate(180deg) rotate(-2deg);" loading="eager">
            <span class="image-caption">"Best recipe" — the wear of love</span>
          </div>
          <div class="memory-text">
            <h2>Grandma</h2>
            <p>
              We remember life at the beach—the smell of the salt air mixing with the "Fry Daddy" working overtime on the counter. We remember the sound of Fox News turned up to volume 100, competing with the laughter of a home that was a refuge for granddaughters and servicemen's wives alike.
            </p>
            <p>
              She knew the sting of austerity, yet she trusted in the Lord with all her heart, turning meager ingredients into feasts of fish, potatoes, and onions sautéing in the pan. Her table was an altar of gratitude for the Lord's provision.
            </p>
          </div>
        </div>
      </section>

      <!-- Section 4: The Continuity (25-35s) -->
      <section class="sanctuary-section" id="sanctuary-continuity">
        <div class="sanctuary-theology">
          <p class="scripture-quote">
            "I am reminded of your sincere faith, a faith that dwelt first in your grandmother..."
            <span class="scripture-attribution">— 2 Timothy 1:5</span>
          </p>
          <p>
            This archive preserves that faith. You will see the stains on the pages—evidence of the Christmas morning casserole, the cobbler made whenever Jackie came to town, and the "nuts and bolts." You will see the wear and tear of love.
          </p>
          <div class="memory-image centered">
            <img src="data/Grandmas-recipes - 97.jpeg" alt="Handwritten recipe with pie drawing" loading="eager">
            <span class="image-caption">"Looks kinda cute" — her own illustration</span>
          </div>
          <p class="luther-quote">
            Martin Luther said that the maid sweeping the floor, if done in faith, is a greater work than the monk's prayer. These recipes are the record of that work.
          </p>
        </div>
      </section>

      <!-- Section 5: Final (35s+) -->
      <section class="sanctuary-section" id="sanctuary-final">
        <p class="sanctuary-closing">
          So please wait while we prepare the table. We are preserving these papers, stains and all, not just to remember how they cooked, but to remember <em>who they were</em>. This is your chance to stand at the counter with them one more time.
        </p>
        <p class="soli-deo-gloria">Soli Deo Gloria.</p>
        <button id="enter-kitchen-btn" class="btn btn-primary sanctuary-enter" style="display: none;">
          Enter the Kitchen
        </button>
      </section>

      <!-- Preload progress (subtle) -->
      <div id="preload-progress" class="preload-progress">
        <div id="preload-bar" class="preload-bar"></div>
      </div>
    </div>
  </div>

  <!-- Authentication Gate -->
  <div id="auth-gate" class="auth-gate" style="display: none;">
    <div class="auth-container">
      <h1>Grandma's Kitchen</h1>
      <p>This is a private family recipe archive.</p>
      <form id="auth-form">
        <label for="auth-answer">What is Grandma's last name?</label>
        <input type="text" id="auth-answer" autocomplete="off" required>
        <button type="submit" class="btn btn-primary">Enter</button>
        <p id="auth-error" class="auth-error" style="display: none;">Incorrect. Please try again.</p>
      </form>
    </div>
  </div>

  <div id="site-content" style="display: none;">
  <header class="site-header">
    <div class="container">
      <h1>Grandma's Kitchen</h1>
      <p class="tagline" style="font-size: 0.9rem; opacity: 0.8;">Soli Deo Gloria</p>
    </div>
  </header>

  <nav class="family-collections">
    <div class="container">
      <span class="nav-label">Family Collections:</span>
      <a href="./" class="active">Grandma</a>
      <a href="https://jsschrstrcks1.github.io/MomsRecipes/">MomMom</a>
      <a href="https://jsschrstrcks1.github.io/Grannysrecipes/">Granny</a>
      <a href="https://jsschrstrcks1.github.io/Allrecipes/">Other Recipes</a>
    </div>
  </nav>

  <nav class="site-nav">
    <div class="container">
      <ul>
        <li><a href="index.html" class="active">All Recipes</a></li>
        <li><a href="#" onclick="filterByCategory('desserts'); return false;">Desserts</a></li>
        <li><a href="#" onclick="filterByCategory('mains'); return false;">Main Dishes</a></li>
        <li><a href="#" onclick="filterByCategory('sides'); return false;">Sides</a></li>
        <li><a href="#" onclick="filterByCategory('snacks'); return false;">Snacks</a></li>
        <li><a href="#" onclick="filterByCategory('beverages'); return false;">Beverages</a></li>
      </ul>
    </div>
  </nav>

  <main>
    <div class="container">
      <!-- Ingredient Search Section - "What Can I Make?" -->
      <section class="ingredient-search-section">
        <div class="ingredient-search-header">
          <h2 class="ingredient-search-title">What Can I Make?</h2>
          <p class="ingredient-search-subtitle">Enter ingredients you have on hand</p>
        </div>

        <!-- Collapsible Help Card -->
        <details class="search-help-card">
          <summary class="search-help-toggle">
            <span class="help-icon">?</span>
            <span>How to use this search</span>
          </summary>
          <div class="search-help-content">
            <p><strong>This search finds recipes two ways:</strong></p>
            <ul>
              <li><strong>By ingredient</strong> - Type what you have (chicken, pasta, etc.) and find recipes you can make</li>
              <li><strong>By recipe name</strong> - Type a dish name (enchiladas, lasagna, etc.) to find matching recipes</li>
            </ul>
            <p><strong>Tips:</strong></p>
            <ul>
              <li>Ingredient pills appear in <span class="help-pill-example ingredient">coral</span></li>
              <li>Recipe search terms appear in <span class="help-pill-example keyword">teal</span></li>
              <li>Combine both! Add "chicken" + search "enchilada" to find chicken enchiladas</li>
              <li>Click a recipe name in the dropdown to go directly to that recipe</li>
            </ul>
          </div>
        </details>

        <!-- Layer 1: Simple Input (Default) -->
        <div class="ingredient-input-wrapper">
          <div class="ingredient-input-container">
            <input
              type="text"
              id="ingredient-input"
              class="ingredient-input"
              placeholder="Search ingredients or recipes..."
              aria-label="Search by ingredients or recipe name"
              autocomplete="off"
            >
            <div id="ingredient-autocomplete" class="ingredient-autocomplete hidden" role="listbox"></div>
          </div>
          <button type="button" id="ingredient-search-btn" class="btn btn-primary" aria-label="Search recipes">
            Find Recipes
          </button>
        </div>

        <!-- Selected Ingredients Pills -->
        <div id="selected-ingredients" class="selected-ingredients hidden">
          <!-- Pills added dynamically -->
        </div>

        <!-- Quick Suggestions -->
        <div class="ingredient-suggestions">
          <span class="suggestion-label">Try:</span>
          <button type="button" class="suggestion-chip" data-ingredient="chicken">chicken</button>
          <button type="button" class="suggestion-chip" data-ingredient="ground beef">ground beef</button>
          <button type="button" class="suggestion-chip" data-ingredient="pasta">pasta</button>
          <button type="button" class="suggestion-chip" data-ingredient="eggs">eggs</button>
          <button type="button" class="suggestion-chip" data-ingredient="cheese">cheese</button>
        </div>

        <!-- Layer 2: Options Panel (Expandable) -->
        <div class="ingredient-options-toggle">
          <button type="button" id="ingredient-options-btn" class="options-toggle-btn" aria-expanded="false">
            <span>More options</span>
            <span class="toggle-icon">&#9660;</span>
          </button>
        </div>

        <div id="ingredient-options-panel" class="ingredient-options-panel hidden">
          <!-- Staples Section -->
          <div class="staples-section">
            <div class="staples-header">
              <label class="staples-toggle">
                <input type="checkbox" id="include-staples" checked>
                <span class="staples-toggle-label">Include my staples</span>
                <span id="staples-count" class="staples-count">(0 items)</span>
              </label>
              <button type="button" id="just-staples-btn" class="just-staples-btn">Just Staples</button>
            </div>

            <div class="staples-management">
              <button type="button" id="edit-staples-btn" class="btn-link">Edit Staples</button>
            </div>

            <!-- Staples Editor (hidden by default) -->
            <div id="staples-editor" class="staples-editor hidden">
              <div class="staples-presets">
                <span class="preset-label">Quick add:</span>
                <button type="button" class="preset-btn" data-preset="basics">+ Basics</button>
                <button type="button" class="preset-btn" data-preset="baking">+ Baking</button>
                <button type="button" class="preset-btn" data-preset="asian">+ Asian</button>
                <button type="button" class="preset-btn" data-preset="mexican">+ Mexican</button>
                <button type="button" class="preset-btn" data-preset="italian">+ Italian</button>
              </div>

              <div class="staples-input-row">
                <input type="text" id="staples-input" class="staples-input" placeholder="Add a staple ingredient...">
                <button type="button" id="add-staple-btn" class="btn btn-small">Add</button>
              </div>

              <div id="staples-list" class="staples-list">
                <!-- Staples pills added dynamically -->
              </div>

              <div class="staples-actions">
                <button type="button" id="clear-staples-btn" class="btn-link btn-danger">Clear All</button>
                <button type="button" id="close-staples-btn" class="btn btn-small btn-secondary">Done</button>
              </div>
            </div>
          </div>

          <!-- Match Mode -->
          <div class="option-group">
            <label class="option-label">Match mode:</label>
            <div class="option-buttons">
              <button type="button" class="option-btn active" data-mode="any">
                Any ingredient
              </button>
              <button type="button" class="option-btn" data-mode="all">
                All ingredients
              </button>
            </div>
          </div>

          <!-- Missing Ingredients Threshold -->
          <div class="option-group">
            <label class="option-label">Show recipes missing up to:</label>
            <div class="option-buttons">
              <button type="button" class="option-btn active" data-missing="0">
                0 (exact match)
              </button>
              <button type="button" class="option-btn" data-missing="1">
                1 ingredient
              </button>
              <button type="button" class="option-btn" data-missing="2">
                2 ingredients
              </button>
              <button type="button" class="option-btn" data-missing="3">
                3 ingredients
              </button>
            </div>
          </div>

          <!-- Clear Search -->
          <div class="option-group">
            <button type="button" id="clear-ingredient-search" class="btn btn-secondary">
              Clear Ingredient Search
            </button>
          </div>
        </div>

        <!-- Search Results Summary -->
        <div id="ingredient-search-results" class="ingredient-search-results hidden">
          <div class="results-header">
            <div class="results-header-left">
              <span id="ingredient-match-count"></span>
              <span id="index-last-updated" class="last-updated-badge"></span>
            </div>
            <div class="results-page-size">
              <label for="results-per-page">Show:</label>
              <select id="results-per-page">
                <option value="10" selected>10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="all">All</option>
              </select>
            </div>
          </div>

          <!-- Smart Suggestions -->
          <div id="ingredient-suggestions" class="ingredient-suggestions-panel hidden">
            <!-- Add Suggestions -->
            <div id="add-suggestions" class="suggestions-group hidden">
              <span class="suggestions-label">Add:</span>
              <div id="add-suggestions-list" class="suggestions-chips">
                <!-- Populated dynamically -->
              </div>
            </div>

            <!-- Remove Suggestions -->
            <div id="remove-suggestions" class="suggestions-group hidden">
              <span class="suggestions-label">Remove:</span>
              <div id="remove-suggestions-list" class="suggestions-chips">
                <!-- Populated dynamically -->
              </div>
            </div>
          </div>

          <!-- Inline Recipe Results -->
          <div id="ingredient-recipe-list" class="ingredient-recipe-list">
            <!-- Populated dynamically -->
          </div>

          <!-- Load More Button -->
          <div id="load-more-container" class="load-more-container hidden">
            <button type="button" id="load-more-recipes" class="btn btn-secondary">
              Load More Recipes
            </button>
            <span id="load-more-status"></span>
          </div>
        </div>
      </section>

      <!-- Search and Filter Section -->
      <section class="search-section">
        <form id="search-form" class="search-box">
          <input type="text" id="search-input" placeholder="Search recipes..." aria-label="Search recipes">
          <button type="submit" class="btn btn-primary">Search</button>
        </form>

        <!-- Collection Filter (Multi-select) -->
        <div class="collection-filter">
          <span class="filter-label">Recipe Box:</span>
          <div class="collection-checkboxes" id="collection-filters">
            <label class="collection-checkbox">
              <input type="checkbox" data-collection="grandma-baker" checked>
              <span class="checkbox-label">Grandma <span class="collection-count" data-count="grandma-baker">(0)</span></span>
            </label>
            <label class="collection-checkbox">
              <input type="checkbox" data-collection="mommom-baker" checked>
              <span class="checkbox-label">MomMom <span class="collection-count" data-count="mommom-baker">(0)</span></span>
            </label>
            <label class="collection-checkbox">
              <input type="checkbox" data-collection="granny-hudson" checked>
              <span class="checkbox-label">Granny <span class="collection-count" data-count="granny-hudson">(0)</span></span>
            </label>
            <label class="collection-checkbox">
              <input type="checkbox" data-collection="all" checked>
              <span class="checkbox-label">Other <span class="collection-count" data-count="all">(0)</span></span>
            </label>
            <button type="button" class="collection-select-all btn-link" id="collection-select-all">Select All</button>
          </div>
        </div>

        <div class="category-filter-row">
          <label for="category-filter" class="filter-label">Category:</label>
          <select id="category-filter" class="category-select">
            <option value="">All Categories</option>
          </select>
        </div>

        <!-- Time Filter -->
        <div class="time-filter-row">
          <label for="time-filter" class="filter-label">Ready in:</label>
          <select id="time-filter" class="time-select">
            <option value="">Any time</option>
            <option value="15">15 min or less</option>
            <option value="30">30 min or less</option>
            <option value="45">45 min or less</option>
            <option value="60">1 hour or less</option>
            <option value="90">1.5 hours or less</option>
            <option value="120">2 hours or less</option>
          </select>
        </div>

        <!-- Nutrition Filters (Collapsible) -->
        <div class="nutrition-section">
          <button type="button" class="nutrition-toggle" id="nutrition-toggle" aria-expanded="false">
            <span class="filter-label">Nutrition Filters</span>
            <span class="toggle-icon">▼</span>
          </button>
          <div id="nutrition-filters" class="nutrition-filters hidden">
            <!-- Diet Presets -->
            <div class="diet-presets">
              <span class="preset-label">Quick filters:</span>
              <button type="button" class="diet-preset-btn" data-diet="low-carb">Low Carb</button>
              <button type="button" class="diet-preset-btn" data-diet="low-cal">Low Cal</button>
              <button type="button" class="diet-preset-btn" data-diet="high-protein">High Protein</button>
              <button type="button" class="diet-preset-btn" data-diet="low-fat">Low Fat</button>
              <button type="button" class="diet-preset-btn" data-diet="low-sodium">Low Sodium</button>
              <button type="button" class="diet-preset-btn" data-diet="clear">Clear</button>
            </div>

            <!-- Custom Ranges -->
            <div class="nutrition-ranges">
              <div class="nutrition-range-row">
                <label>Calories:</label>
                <input type="number" id="cal-min" placeholder="Min" min="0">
                <span>to</span>
                <input type="number" id="cal-max" placeholder="Max" min="0">
              </div>
              <div class="nutrition-range-row">
                <label>Carbs (g):</label>
                <input type="number" id="carbs-min" placeholder="Min" min="0">
                <span>to</span>
                <input type="number" id="carbs-max" placeholder="Max" min="0">
              </div>
              <div class="nutrition-range-row">
                <label>Protein (g):</label>
                <input type="number" id="protein-min" placeholder="Min" min="0">
                <span>to</span>
                <input type="number" id="protein-max" placeholder="Max" min="0">
              </div>
              <div class="nutrition-range-row">
                <label>Fat (g):</label>
                <input type="number" id="fat-min" placeholder="Min" min="0">
                <span>to</span>
                <input type="number" id="fat-max" placeholder="Max" min="0">
              </div>
            </div>

            <!-- Only with nutrition toggle -->
            <div class="nutrition-options">
              <label class="nutrition-checkbox">
                <input type="checkbox" id="only-with-nutrition">
                <span>Only show recipes with nutrition data</span>
              </label>
            </div>

            <button type="button" id="apply-nutrition-filter" class="btn btn-small btn-primary">Apply Filters</button>
          </div>
        </div>

        <!-- Collapsible Tags Section (starts closed) -->
        <div class="tags-section">
          <button type="button" class="tags-toggle" id="tags-toggle" aria-expanded="false">
            <span class="filter-label">Tags</span>
            <span class="toggle-icon">▶</span>
          </button>
          <div id="tag-filters" class="filter-tags hidden">
            <!-- Tags populated by JavaScript -->
          </div>
        </div>

        <!-- Shopping List / Meal Plan Section -->
        <div class="shopping-section">
          <button type="button" class="shopping-toggle" id="shopping-toggle" aria-expanded="false">
            <span class="filter-label">Meal Plan & Shopping List</span>
            <span class="toggle-icon">▼</span>
          </button>
          <div id="shopping-list-panel" class="shopping-list-panel hidden">
            <div class="shopping-list-empty">
              <p>No recipes selected. Add recipes to your meal plan to generate a shopping list.</p>
            </div>
          </div>
        </div>

        <!-- Share Link Button -->
        <div class="share-section">
          <button type="button" class="btn btn-secondary btn-block" onclick="copyShareableLink()">
            Copy Search Link
          </button>
        </div>
      </section>

      <!-- Recipe Grid -->
      <section>
        <div id="recipe-grid" class="recipe-grid">
          <div class="text-center" style="grid-column: 1/-1; padding: 2rem;">
            <p>Loading recipes...</p>
          </div>
        </div>
      </section>

      <!-- A-Z Index -->
      <section class="index-section" style="margin-top: 3rem;">
        <h2>Recipe Index</h2>
        <div id="alpha-index" class="alpha-index">
          <!-- Populated by JavaScript -->
        </div>
        <div id="index-list">
          <!-- Populated by JavaScript -->
        </div>
      </section>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>Grandma's Kitchen &middot; A Family Treasure</p>
      <p style="margin-top: 0.5rem; font-size: 0.8rem;">From Michigan to Florida &middot; Preserved with Love</p>
    </div>
  </footer>
  </div><!-- end site-content -->

  <script>
    // Sanctuary + Authentication System
    (function() {
      const AUTH_KEY = 'grandmas-kitchen-auth';
      const CORRECT_ANSWER = 'Baker';
      const SHARD_CACHE_KEY = 'grandmas-kitchen-shards-cached';

      // All shards in priority order: Grandma, Granny, MomMom categories, All categories
      const ALL_SHARDS = [
        'recipes-grandma-baker.json',
        'recipes-granny-hudson.json',
        // MomMom categories
        'recipes-mommom-baker-desserts.json',
        'recipes-mommom-baker-mains.json',
        'recipes-mommom-baker-breads.json',
        'recipes-mommom-baker-sides.json',
        'recipes-mommom-baker-breakfast.json',
        'recipes-mommom-baker-appetizers.json',
        'recipes-mommom-baker-salads.json',
        'recipes-mommom-baker-snacks.json',
        'recipes-mommom-baker-soups.json',
        'recipes-mommom-baker-beverages.json',
        'recipes-mommom-baker-reference.json',
        'recipes-mommom-baker-tips.json',
        // All categories
        'recipes-all-mains.json',
        'recipes-all-desserts.json',
        'recipes-all-breads.json',
        'recipes-all-breakfast.json',
        'recipes-all-sides.json',
        'recipes-all-soups.json',
        'recipes-all-salads.json',
        'recipes-all-appetizers.json',
        'recipes-all-beverages.json',
        'recipes-all-reference.json',
        'recipes-all-snacks.json'
      ];

      let shardsLoaded = 0;
      let preloadComplete = false;
      let sanctuaryTimerComplete = false;

      // ===== Authentication Functions =====
      function checkAuth() {
        return localStorage.getItem(AUTH_KEY) === 'true';
      }

      function showSite() {
        document.getElementById('sanctuary').style.display = 'none';
        document.getElementById('auth-gate').style.display = 'none';
        document.getElementById('site-content').style.display = 'block';
      }

      function showGate() {
        document.getElementById('sanctuary').style.display = 'none';
        document.getElementById('auth-gate').style.display = 'flex';
        document.getElementById('site-content').style.display = 'none';
      }

      function showSanctuary() {
        document.getElementById('sanctuary').style.display = 'flex';
        document.getElementById('auth-gate').style.display = 'none';
        document.getElementById('site-content').style.display = 'none';
      }

      // ===== Shard Preloading =====
      async function checkShardsInCache() {
        // Check if browser supports Cache API
        if (!('caches' in window)) {
          return false;
        }
        try {
          // Simple check: see if the first few critical shards are cached
          const cache = await caches.open('grandmas-kitchen-shards');
          const criticalShards = ALL_SHARDS.slice(0, 4); // First 4 shards
          for (const shard of criticalShards) {
            const response = await cache.match(`data/${shard}`);
            if (!response) return false;
          }
          return true;
        } catch (e) {
          return false;
        }
      }

      async function preloadShard(shardFile) {
        try {
          const url = `data/${shardFile}`;
          const response = await fetch(url);
          if (response.ok) {
            // Cache the response if Cache API is available
            if ('caches' in window) {
              const cache = await caches.open('grandmas-kitchen-shards');
              cache.put(url, response.clone());
            }
            return true;
          }
        } catch (e) {
          console.warn(`Failed to preload ${shardFile}:`, e);
        }
        return false;
      }

      async function preloadAllShards() {
        const statusEl = document.getElementById('loading-status');
        const progressBar = document.getElementById('preload-bar');

        for (let i = 0; i < ALL_SHARDS.length; i++) {
          const shard = ALL_SHARDS[i];
          await preloadShard(shard);
          shardsLoaded++;

          // Update progress bar
          const progress = (shardsLoaded / ALL_SHARDS.length) * 100;
          if (progressBar) progressBar.style.width = `${progress}%`;

          // Update status text periodically
          if (statusEl && shardsLoaded % 3 === 0) {
            const collection = shard.includes('grandma') ? 'Grandma' :
                              shard.includes('granny') ? 'Granny' :
                              shard.includes('mommom') ? 'MomMom' : 'Other';
            statusEl.textContent = `Loading ${collection}'s recipes...`;
          }
        }

        preloadComplete = true;
        if (statusEl) statusEl.textContent = 'All recipes loaded!';
        localStorage.setItem(SHARD_CACHE_KEY, Date.now().toString());

        checkShowEnterButton();
      }

      // ===== Sanctuary Timing =====
      function runSanctuarySequence() {
        const sections = [
          { id: 'sanctuary-intro', delay: 0 },
          { id: 'sanctuary-granny', delay: 5000 },
          { id: 'sanctuary-grandma', delay: 15000 },
          { id: 'sanctuary-continuity', delay: 25000 },
          { id: 'sanctuary-final', delay: 35000 }
        ];

        sections.forEach(({ id, delay }) => {
          setTimeout(() => {
            const section = document.getElementById(id);
            if (section) section.classList.add('visible');
          }, delay);
        });

        // After 35 seconds, allow entry
        setTimeout(() => {
          sanctuaryTimerComplete = true;
          checkShowEnterButton();
        }, 35000);
      }

      function checkShowEnterButton() {
        // Show button if timer complete OR if all cached (instant entry)
        if (sanctuaryTimerComplete || preloadComplete) {
          const btn = document.getElementById('enter-kitchen-btn');
          if (btn) {
            btn.style.display = 'inline-block';
          }
          // Hide loading indicator
          const loadingEl = document.querySelector('.sanctuary-loading');
          if (loadingEl) loadingEl.classList.add('hidden');
        }
      }

      // ===== Enter Kitchen Handler =====
      function handleEnterKitchen() {
        if (checkAuth()) {
          showSite();
        } else {
          showGate();
        }
      }

      // ===== Initialization =====
      async function init() {
        // Check if shards are already cached
        const allCached = await checkShardsInCache();

        if (allCached) {
          // Shards are cached - show sanctuary but allow immediate entry
          showSanctuary();
          runSanctuarySequence();

          // Show all sections immediately and enable button
          document.querySelectorAll('.sanctuary-section').forEach(s => s.classList.add('visible'));
          sanctuaryTimerComplete = true;
          preloadComplete = true;
          checkShowEnterButton();
        } else {
          // Need to preload - show full sanctuary experience
          showSanctuary();
          runSanctuarySequence();
          preloadAllShards(); // Start preloading in background
        }

        // Set up enter button handler
        const enterBtn = document.getElementById('enter-kitchen-btn');
        if (enterBtn) {
          enterBtn.addEventListener('click', handleEnterKitchen);
        }

        // Set up auth form handler
        document.getElementById('auth-form').addEventListener('submit', function(e) {
          e.preventDefault();
          const answer = document.getElementById('auth-answer').value;
          if (answer === CORRECT_ANSWER) {
            localStorage.setItem(AUTH_KEY, 'true');
            showSite();
          } else {
            document.getElementById('auth-error').style.display = 'block';
            document.getElementById('auth-answer').value = '';
            document.getElementById('auth-answer').focus();
          }
        });
      }

      // Start when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
  <script src="script.min.js"></script>
  <script>
    // Additional home page functionality
    function filterByCategory(category) {
      const select = document.getElementById('category-filter');
      if (select) {
        select.value = category;
        select.dispatchEvent(new Event('change'));
      }
    }

    // Build A-Z index after recipes load
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(buildAlphaIndex, 500);
    });

    function buildAlphaIndex() {
      const indexContainer = document.getElementById('alpha-index');
      const listContainer = document.getElementById('index-list');

      if (!indexContainer || !listContainer || !window.recipes) return;

      // Wait for recipes to load
      if (recipes.length === 0) {
        setTimeout(buildAlphaIndex, 500);
        return;
      }

      // Get unique first letters
      const letters = new Set();
      recipes.forEach(r => {
        if (r.title && !r.variant_of) {
          letters.add(r.title.charAt(0).toUpperCase());
        }
      });

      // Build A-Z navigation
      let alphaHtml = '';
      for (let i = 65; i <= 90; i++) {
        const letter = String.fromCharCode(i);
        const hasRecipes = letters.has(letter);
        alphaHtml += `<a href="#letter-${letter}" class="${hasRecipes ? '' : 'disabled'}">${letter}</a>`;
      }
      indexContainer.innerHTML = alphaHtml;

      // Build recipe list grouped by letter
      const grouped = {};
      recipes.forEach(r => {
        if (r.variant_of && r.variant_of !== r.id) return;
        const letter = r.title.charAt(0).toUpperCase();
        if (!grouped[letter]) grouped[letter] = [];
        grouped[letter].push(r);
      });

      let listHtml = '';
      Object.keys(grouped).sort().forEach(letter => {
        listHtml += `<h3 id="letter-${letter}" style="margin-top: 1.5rem;">${letter}</h3>`;
        listHtml += '<ul class="recipe-index-list">';
        grouped[letter].sort((a, b) => a.title.localeCompare(b.title)).forEach(r => {
          listHtml += `<li><a href="recipe.html#${r.id}">${r.title}</a> <span class="text-muted">(${r.category})</span></li>`;
        });
        listHtml += '</ul>';
      });

      listContainer.innerHTML = listHtml;
    }

    // Make recipes accessible globally for buildAlphaIndex
    window.recipes = [];
    const originalLoadRecipes = loadRecipes;
    loadRecipes = async function() {
      await originalLoadRecipes();
      window.recipes = recipes;
    };
  </script>
</body>
</html>
